<div class="settings-container" data-controller="settings">
  <section name="settings">
    <header>
      <h2>Settings</h2>
      <hr class="separator" />
    </header>
  </section>

  <div class="alert" data-target="settings.alert">
    <div class="alert-header">
    </div>
    <div class="alert-body"></div>
  </div>

  <section name="organizations">
    <header>
      <h3 class="setttings-title">ORGANIZATIONS</h3>
    </header>

    <div class="organizations-list">
      <div class="organization">
        <div class="organization-avatar"><img src="<%= viewer.avatar_url  %>" alt="<%= viewer.name %>"></div>
        <div class="organization-name"><%= viewer.name %></div>
        <div class="organization-login">@<%= viewer.login %></div>
      </div>
      <% viewer.organizations.nodes.each do |org| %>
        <div class="organization">
          <div class="organization-avatar"><img src="<%= org.avatar_url %>" alt="<%= org.name %>"></div>
          <div class="organization-name"><%= org.name %></div>
          <div class="organization-login">@<%= org.login %></div>
        </div>
      <% end %>
    </div>
  </section>

  <section name="repositories">
    <header>
      <h3 class="setttings-title">REPOSITORIES</h3>
    </header>

    <%= form_with(url: "/#{current_user&.nickname}/settings/save", method: :post, data: { 'action': 'ajax:success->settings#onSuccess ajax:before->settings#onSubmit ajax:error->settings#onError' }) do |f| %>
      <div class="repositories-list">
        <% repos.each do |repo| %>
          <div class="repository">
            <% if current_user.settings['repos'].include? repo.name %>
              <%= check_box_tag('repo[]', repo.name, true, { id: repo.name }) %>
            <% else %>
              <%= check_box_tag('repo[]', repo.name, false, { id: repo.name }) %>
            <% end %>
            <%= label_tag(repo.name, repo.name) %>
            <% if repo.is_private %>
              <i class="fas fa-lock"></i>
            <% end %>
          </div>
        <% end %>
      </div>
      <div class="settings-actions space-top">
        <%= link_to 'Cancel', root_url, class: 'settings-cancel space-right-1' %>
        <%= f.button('Save', type: :submit, class: 'settings-save-btn') do %>
          <i class="fas fa-circle-notch fa-spin js-loading-indicator hidden"></i>
          Save
        <% end %>
      </div>
    <% end %>
  </section
</div>

